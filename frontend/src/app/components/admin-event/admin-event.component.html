@if (event(); as evt) {
<div class="admin-event">
  <div class="header">
    <h2>Manage: {{ evt.title }}</h2>
    <button class="secondary" [routerLink]="['/events', evt.slug]">
      Back to event
    </button>
  </div>

  <div class="card">
    <div class="capacity-warning">
      <p class="info-text">
        <strong>Note:</strong> Adjusting capacity will automatically manage
        attendee status. Reducing capacity moves confirmed attendees to the
        waitlist, while increasing capacity promotes waitlisted attendees to
        confirmed status.
      </p>
    </div>
    <h3>Capacity management</h3>
    <div class="capacity-control">
      <input
        type="number"
        [(ngModel)]="newCapacity"
        min="0"
        placeholder="New capacity"
      />
      <button
        class="primary"
        (click)="updateCapacity()"
        [disabled]="updating()"
      >
        Update capacity
      </button>
    </div>
  </div>

  <div class="card">
    <h3>Confirmed attendees ({{ attendees().confirmed.length }})</h3>
    @if (attendees().confirmed.length) {
    <div class="attendees-table">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Registered</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (attendee of attendees().confirmed; track attendee.id) {
          <tr>
            <td>{{ attendee.name }}</td>
            <td>{{ attendee.email }}</td>
            <td>{{ attendee.createdAt | date : "dd.MM.yyyy HH:mm:ss" }}</td>
            <td>
              <button
                class="danger small"
                (click)="removeAttendee(attendee.email)"
              >
                Remove
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @else {
    <p>No confirmed attendees</p>
    }
  </div>

  <div class="card">
    <h3>Waitlisted attendees ({{ attendees().waitlisted.length }})</h3>
    @if (attendees().waitlisted.length) {
    <div class="attendees-table">
      <table>
        <thead>
          <tr>
            <th>Name</th>
            <th>Email</th>
            <th>Registered</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          @for (attendee of attendees().waitlisted; track attendee.id) {
          <tr>
            <td>{{ attendee.name }}</td>
            <td>{{ attendee.email }}</td>
            <td>{{ attendee.createdAt | date : "dd.MM.yyyy HH:mm:ss" }}</td>
            <td>
              <button
                class="danger small"
                (click)="removeAttendee(attendee.email)"
              >
                Remove
              </button>
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>
    } @else {
    <p>No waitlisted attendees</p>
    }
  </div>

  <div class="card">
    <h3>Admin management</h3>
    @if (admins().length) {
    <div class="admin-list">
      @for (admin of admins(); track admin) {
      <div class="admin-item">
        <span>{{ admin }}</span>
        @if (admins().length > 1 && admin !== admins()[0]) {
        <button class="danger small" (click)="removeAdmin(admin)">
          Remove
        </button>
        }
      </div>
      }
    </div>
    }
    <div class="add-admin">
      <input
        type="email"
        [(ngModel)]="newAdminEmail"
        placeholder="Admin email"
      />
      <button
        class="primary"
        (click)="addAdmin()"
        required
        [disabled]="!newAdminEmail || updating()"
      >
        Add admin
      </button>
    </div>
  </div>

  @if (email() === admins()[0]) {
  <div class="card danger-zone">
    <h3>Danger zone</h3>
    <button class="danger" (click)="deleteEvent()">Delete event</button>
  </div>
  }
</div>
}
