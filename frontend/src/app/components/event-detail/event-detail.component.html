@if (loading() && !event()) {
  <div class="min-h-screen bg-background py-16">
    <div class="mx-auto max-w-3xl px-4 sm:px-6">
      <div class="mb-6">
        <hlm-skeleton class="h-10 w-48" />
      </div>
      <div class="rounded-lg border bg-card p-6 shadow-sm">
        <div class="space-y-6">
          <hlm-skeleton class="h-8 w-3/4" />
          <div class="grid gap-4 sm:grid-cols-3">
            @for (_ of [1, 2, 3]; track $index) {
              <div class="rounded-lg border border-border p-4">
                <hlm-skeleton class="h-4 w-20 mb-2" />
                <hlm-skeleton class="h-8 w-16" />
              </div>
            }
          </div>
          <div class="rounded-lg border border-border p-6">
            <hlm-skeleton class="h-6 w-32 mb-4" />
            <hlm-skeleton class="h-10 w-full" />
          </div>
        </div>
      </div>
    </div>
  </div>
} @else {
  @if (event(); as evt) {
    <div class="min-h-screen bg-background py-16">
      <div class="mx-auto max-w-3xl px-4 sm:px-6">
        <div class="mb-6 flex items-center justify-between">
          <button
            hlmBtn
            variant="ghost"
            size="sm"
            routerLink="/events"
            class="-ml-2"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="mr-1.5"
            >
              <path d="m15 18-6-6 6-6" />
            </svg>
            Events
          </button>
          @if (evt.isAdmin) {
            <button
              hlmBtn
              variant="outline"
              size="sm"
              [routerLink]="['/admin/events', evt.slug]"
            >
              Manage
            </button>
          }
        </div>

        <div hlmCard>
          <div
            hlmCardHeader
            class="flex flex-row items-start justify-between gap-4"
          >
            <div class="flex-1">
              <h3 hlmCardTitle class="text-2xl">{{ evt.title }}</h3>
            </div>
            <button
              hlmBtn
              variant="ghost"
              size="sm"
              (click)="shareEvent()"
              title="Share event"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="18" cy="5" r="3" />
                <circle cx="6" cy="12" r="3" />
                <circle cx="18" cy="19" r="3" />
                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49" />
                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49" />
              </svg>
            </button>
          </div>

          <div hlmCardContent class="space-y-6">
            <div class="grid gap-4 sm:grid-cols-3">
              <div class="rounded-lg border border-border p-4">
                <span class="text-sm text-muted-foreground">Capacity</span>
                <div class="mt-1 text-2xl font-semibold text-foreground">
                  {{ evt.confirmedCount }} / {{ evt.capacity }}
                </div>
              </div>
              @if (evt.waitlistedCount > 0) {
                <div class="rounded-lg border border-border p-4">
                  <span class="text-sm text-muted-foreground">Waitlist</span>
                  <div class="mt-1 text-2xl font-semibold text-foreground">
                    {{ evt.waitlistedCount }}
                  </div>
                </div>
              }
              <div class="rounded-lg border border-border p-4">
                <span class="text-sm text-muted-foreground">Status</span>
                <div class="mt-1">
                  <span
                    hlmBadge
                    [variant]="
                      evt.confirmedCount < evt.capacity ? 'success' : 'warning'
                    "
                  >
                    {{
                      evt.confirmedCount < evt.capacity
                        ? "Space available"
                        : "Full"
                    }}
                  </span>
                </div>
              </div>
            </div>

            @if (isAuthenticated()) {
              <div class="rounded-lg border border-border p-6">
                @if (!evt.requesterStatus) {
                  <div class="space-y-4">
                    <h4 class="font-semibold text-foreground">
                      RSVP for this event
                    </h4>
                    <div class="flex gap-3">
                      <input
                        hlmInput
                        type="text"
                        [(ngModel)]="userName"
                        placeholder="Your name"
                        class="flex-1"
                      />
                      <button
                        hlmBtn
                        (click)="attend()"
                        [disabled]="!userName || loading()"
                      >
                        RSVP
                      </button>
                    </div>
                  </div>
                } @else {
                  <div class="flex items-center justify-between">
                    <div>
                      <p class="text-sm text-muted-foreground">Your status:</p>
                      <span
                        hlmBadge
                        class="mt-1"
                        [variant]="
                          evt.requesterStatus === 'CONFIRMED'
                            ? 'success'
                            : 'warning'
                        "
                      >
                        {{ evt.requesterStatus | titlecase }}
                      </span>
                    </div>
                    <button
                      hlmBtn
                      variant="destructive"
                      (click)="cancel()"
                      [disabled]="loading()"
                    >
                      Cancel RSVP
                    </button>
                  </div>
                }
              </div>
            } @else {
              <div class="rounded-lg border border-border p-6 text-center">
                <p class="text-muted-foreground">
                  Please sign in to RSVP for this event.
                </p>
              </div>
            }
          </div>
        </div>
      </div>
    </div>

    <!-- Cancel RSVP Dialog -->
    <hlm-alert-dialog
      [open]="showCancelDialog()"
      title="Cancel RSVP"
      description="Are you sure you want to cancel your RSVP? You can always re-register if spots are available."
      confirmText="Cancel RSVP"
      cancelText="Keep RSVP"
      [destructive]="true"
      (confirmed)="confirmCancel()"
      (cancelled)="showCancelDialog.set(false)"
    />
  }
}
